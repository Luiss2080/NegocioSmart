{% extends "base.html" %}

{% block title %}Factura {{ factura.folio }} - VentaPro{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="../static/css/factura.css">
{% endblock %}

{% block content %}
<div class="factura-container">
    <!-- Encabezado de la factura -->
    <div class="factura-header">
        <div class="factura-info">
            <h2>FACTURA</h2>
            <div class="factura-datos">
                <p><strong>Folio:</strong> {{ factura.folio }}</p>
                <p><strong>Fecha:</strong> {{ factura.fecha_venta|strftime('%d/%m/%Y') }}</p>
                <p><strong>Hora:</strong> {{ factura.fecha_venta|strftime('%H:%M:%S') }}</p>
            </div>
        </div>
        <div class="logo-factura">
            <img src="../assets/images/logo_factura.png" alt="Logo Factura">
        </div>
    </div>

    <!-- Información del cliente -->
    <div class="cliente-section">
        <h3>Datos del Cliente</h3>
        <div class="cliente-info">
            <p><strong>Cliente:</strong> {{ cliente.nombre_completo|default('Cliente General') }}</p>
            {% if cliente.direccion %}
            <p><strong>Dirección:</strong> {{ cliente.direccion }}</p>
            {% endif %}
            {% if cliente.telefono %}
            <p><strong>Teléfono:</strong> {{ cliente.telefono }}</p>
            {% endif %}
            {% if cliente.rfc %}
            <p><strong>RFC:</strong> {{ cliente.rfc }}</p>
            {% endif %}
            {% if cliente.email %}
            <p><strong>Email:</strong> {{ cliente.email }}</p>
            {% endif %}
        </div>
    </div>

    <!-- Detalles de productos -->
    <div class="productos-section">
        <h3>Detalle de Productos</h3>
        <table class="productos-table">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>P. Unitario</th>
                    <th>Descuento</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for detalle in factura.detalles %}
                <tr>
                    <td>{{ detalle.producto.codigo }}</td>
                    <td>{{ detalle.producto.nombre }}</td>
                    <td class="text-center">{{ detalle.cantidad }}</td>
                    <td class="text-right">${{ "%.2f"|format(detalle.precio_unitario) }}</td>
                    <td class="text-right">
                        {% if detalle.descuento_linea > 0 %}
                        ${{ "%.2f"|format(detalle.descuento_linea) }}
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td class="text-right"><strong>${{ "%.2f"|format(detalle.subtotal_linea) }}</strong></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Totales -->
    <div class="totales-section">
        <div class="totales-tabla">
            <table class="totales">
                <tr>
                    <td>Subtotal:</td>
                    <td class="text-right">${{ "%.2f"|format(factura.subtotal) }}</td>
                </tr>
                {% if factura.descuento > 0 %}
                <tr>
                    <td>Descuento:</td>
                    <td class="text-right">-${{ "%.2f"|format(factura.descuento) }}</td>
                </tr>
                {% endif %}
                <tr>
                    <td>IVA (16%):</td>
                    <td class="text-right">${{ "%.2f"|format(factura.impuestos) }}</td>
                </tr>
                <tr class="total-final">
                    <td><strong>TOTAL:</strong></td>
                    <td class="text-right"><strong>${{ "%.2f"|format(factura.total) }}</strong></td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Información de pago -->
    <div class="pago-section">
        <div class="pago-info">
            <p><strong>Método de Pago:</strong> {{ factura.metodo_pago|title }}</p>
            <p><strong>Estado:</strong> {{ factura.estado|title }}</p>
        </div>
    </div>

    <!-- Pie de factura -->
    <div class="factura-footer">
        <div class="agradecimiento">
            <p>{{ factura_pie|default('¡Gracias por su compra!') }}</p>
        </div>
        
        <div class="factura-qr">
            <!-- Aquí iría un código QR si se implementa -->
            <div class="qr-placeholder">
                <p>Código QR</p>
            </div>
        </div>
        
        <div class="info-adicional">
            <p><small>Esta factura fue generada electrónicamente por VentaPro</small></p>
            <p><small>Número de productos: {{ factura.cantidad_productos }}</small></p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Funciones específicas para la factura
document.addEventListener('DOMContentLoaded', function() {
    // Auto-imprimir si está en modo impresión
    if (window.location.search.includes('print=true')) {
        window.print();
    }
});
</script>
{% endblock %}